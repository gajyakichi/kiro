generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Project {
  id               Int               @id @default(autoincrement())
  name             String
  icon             String?
  git_path         String?
  artifact_path    String?
  comments         Comment[]
  dailyNotes       DailyNote[]
  logs             Log[]
  suggestedTasks   SuggestedTask[]
  conversationLogs ConversationLog[]
  absorbCaches     AbsorbCache[]
}

model Log {
  id         Int      @id @default(autoincrement())
  timestamp  DateTime @default(now())
  type       String
  content    String
  metadata   String?
  project_id Int
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model Comment {
  id         Int      @id @default(autoincrement())
  timestamp  DateTime @default(now())
  text       String
  type       String   @default("markdown")
  metadata   String?
  project_id Int
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model Theme {
  id        Int      @id @default(autoincrement())
  name      String
  css       String
  iconSet   String   @default("lucide")
  active    Boolean  @default(false)
  isPreset  Boolean  @default(false)
  timestamp DateTime @default(now())
}

model DailyNote {
  id         Int      @id @default(autoincrement())
  project_id Int
  date       String
  content    String
  content_en String?
  content_ja String?
  timestamp  DateTime @default(now())
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([project_id, date])
}

model SuggestedTask {
  id         Int      @id @default(autoincrement())
  project_id Int
  task       String
  status     String   @default("proposed")
  timestamp  DateTime @default(now())
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model ConversationLog {
  id         Int      @id @default(autoincrement())
  project_id Int
  date       String
  agent      String
  summary    String
  full_text  String?
  metadata   String?  // JSON string for storing KI path and other metadata
  timestamp  DateTime @default(now())
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model AbsorbCache {
  id              Int      @id @default(autoincrement())
  project_id      Int
  git_hash        String
  summary_content String
  summary_en      String?
  summary_ja      String?
  timestamp       DateTime @default(now())
  project         Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([project_id, git_hash])
}
