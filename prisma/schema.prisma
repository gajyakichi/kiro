generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
}

model Project {
  id               Int               @id @default(autoincrement())
  name             String
  icon             String?
  git_path         String?
  artifact_path    String?
  comments         Comment[]
  dailyNotes       DailyNote[]
  logs             Log[]
  suggestedTasks   SuggestedTask[]
  conversationLogs ConversationLog[]
  absorbCaches     AbsorbCache[]
}

model Log {
  id         Int      @id @default(autoincrement())
  project_id Int
  content    String
  timestamp  DateTime @default(now())
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model SuggestedTask {
  id              Int      @id @default(autoincrement())
  project_id      Int
  title           String
  description     String?
  status          String   @default("proposed")
  created_at      DateTime @default(now())
  project         Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model ConversationLog {
  id              Int      @id @default(autoincrement())
  project_id      Int
  summary         String
  detail          String?
  created_at      DateTime @default(now())
  project         Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model DailyNote {
  id         Int      @id @default(autoincrement())
  project_id Int
  date       String
  content    Json
  content_en String?
  content_ja String?
  timestamp  DateTime @default(now())
  project    Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([project_id, date])
}

model Comment {
  id              Int      @id @default(autoincrement())
  project_id      Int
  file_path       String
  line_number     Int
  content         String
  resolved        Boolean  @default(false)
  created_at      DateTime @default(now())
  project         Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)
}

model AbsorbCache {
  id              Int      @id @default(autoincrement())
  project_id      Int
  file_path       String
  file_hash       String
  summary_content String
  updated_at      DateTime @default(now())
  project         Project  @relation(fields: [project_id], references: [id], onDelete: Cascade)

  @@unique([project_id, file_path])
}
